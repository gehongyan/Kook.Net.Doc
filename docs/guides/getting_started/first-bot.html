<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>从零开始 | Kook.Net 文档 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="从零开始 | Kook.Net 文档 ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/gehongyan/Kook.Net/blob/master/docs/guides/getting_started/first-bot.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  <meta property="og:description" content="本指南将引导您使用 Kook.Net 构建一个简单的 Bot。在此之前，请先确保您已参与 KOOK 开发者，并获得开发权限。"><meta property="og:title" content="从零开始 | Kook.Net 文档 "><meta property="og:site_name" content="Discord.Net Docs"><meta name="theme-color" content="#995EA7"><meta property="og:image" content="https://raw.githubusercontent.com/Discord-Net/Discord.Net/dev/docs/marketing/logo/PackageLogo.png"></head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo/Logo_Small.png" alt="Kook.Net 文档">
            Kook.Net 文档
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="Guides.GettingStarted.FirstBot">
<h1 id="使用-kooknet-构建你的第一个-bot">使用 Kook.Net 构建你的第一个 Bot</h1>

<p>本指南将引导您使用 Kook.Net 构建一个简单的 Bot。在此之前，请先确保您已参与 KOOK 开发者，并获得开发权限。</p>
<h2 id="创建一个-kook-应用">创建一个 KOOK 应用</h2>
<p>在开始编写代码前，您需要通过 KOOK 开发者中心创建一个 Bot。</p>
<ol>
<li><p>访问并登录到 <a href="https://developer.kaiheila.cn/app/index">KOOK 开发者中心</a>；</p>
</li>
<li><p>点击 <code>新建应用</code>；</p>
</li>
<li><p>填写应用名称；</p>
</li>
<li><p>点击刚刚创建好的应用；</p>
</li>
<li><p>点击左侧的 <code>机器人</code>；</p>
<p><img src="images/intro/intro-bot-entrance.png" alt="img.png"></p>
</li>
<li><p>确保机器人的连接模式为 <code>WebSocket</code>；</p>
<p><img src="images/intro/intro-bot-websocket.png" alt="img.png"></p>
</li>
<li><p>(可选) 如果要创建公共 Bot，开启 <code>开启公共机器人</code> 开关。</p>
<p><img src="images/intro/intro-bot-public.png" alt="img.png"></p>
</li>
</ol>
<h2 id="将-bot-添加到服务器">将 Bot 添加到服务器</h2>
<p>Bot 无法通过访问服务器的邀请链接进入频道，因此需要 Bot 的邀请链接将 Bot 添加到服务器。</p>
<ol>
<li><p>在 <a href="https://developer.kaiheila.cn/bot">KOOK 开发者中心</a> 中访问要添加到服务器的 Bot 应用；</p>
</li>
<li><p>点击左侧的 <code>邀请链接</code>；</p>
<p><img src="images/intro/intro-bot-invite.png" alt="img.png"></p>
</li>
<li><p>在右侧的 <code>角色权限设置</code> 中勾选要在 Bot 进入服务器后直接拥有的权限；</p>
<div class="NOTE">
<h5>Note</h5>
<p>这将会在服务器内创建一个仅可授予给该 Bot 的托管角色，该 Bot 将会在进入服务器后自动获得该角色。
如需在进入服务器后变更权限，可通过 <code>服务器设置</code> 中的 <code>角色权限</code> 进行修改。</p>
</div>
</li>
<li><p>打开上方生成的邀请链接；</p>
</li>
<li><p>选择要将 Bot 添加到的服务器；</p>
</li>
<li><p>点击邀请。</p>
<p><img src="images/intro/intro-bot-select.png" alt="img.png"></p>
<div class="NOTE">
<h5>Note</h5>
<p>列表中仅显示您拥有 <code>管理服务器</code> 权限的服务器。</p>
</div>
</li>
</ol>
<h2 id="将-bot-连接至-kook">将 Bot 连接至 KOOK</h2>
<p>如果您已创建工程，并安装了 Kook.Net，可参考以下步骤，
否则，请参考 <a class="xref" href="installing.html">安装 Kook.Net</a> 。</p>
<h3 id="异步启动">异步启动</h3>
<p>Kook.Net 广泛采用 .NET 的 <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/async">异步编程模型</a>，绝大多数操作都是以异步方式完成，
请尽可能地在异步上下文中等待这些操作。</p>
<p>C# 9.0 引入了顶级语句，可以在不显式创建 Program 类和 Main 方法的情况下编写代码，
顶级语句中使用 await 来调用异步方法，会自动建立一个在异步上下文中启动的程序。</p>
<div class="WARNING">
<h5>Warning</h5>
<p>应用程序中异步上下文抛出的任何异常都会被持续向上层抛出直到首个同步方法，
抛出至顶级语句的<strong>所有</strong>未经处理的异常将导致程序退出。</p>
<p>Kook.Net 会捕获事件处理函数中发生的异常，以避免该异常导致程序退出，
但需要注意的是，如果异常发生在 async void 所标记的方法中，
尽管异常发生在异步上下文中，但该异常仍会导致程序退出。
因此，请合理使用 async Task 与 await 的组合。</p>
</div>
<h3 id="创建日志方法">创建日志方法</h3>
<p>在创建并配置 KOOK Bot 客户端程序前，我们需要创建一个事件处理程序来订阅 Kook.Net 的日志事件。</p>
<p>为了尽可能地广泛支持各种日志提供程序，Kook.Net 通过 <code>Log</code> 事件来记录日志信息，
其事件参数为 <code>LogMessage</code>。有关该事件地详细信息，可参考 <a class="xref" href="../../api/Kook.Rest.BaseKookClient.html#Kook_Rest_BaseKookClient_Log">API 文档</a>。</p>
<p>如需要使用自己的日志记录框架，请在此该事件行调用。此处，为了简单起见，我们仅将日志记录到控制台中。</p>
<pre><code class="lang-csharp" name="Simple Logging">// Log 事件，此处以直接输出到控制台为例
Task LogAsync(LogMessage log)
{
    Console.WriteLine(log.ToString());
    return Task.CompletedTask;
}
</code></pre><h3 id="创建-kook-bot-客户端程序">创建 KOOK Bot 客户端程序</h3>
<p>为了编写一个能与 KOOK 服务端实时互动的 Bot，请使用 <a class="xref" href="../../api/Kook.WebSocket.KookSocketClient.html">KookSocketClient</a> 作为客户端，
使用 Socket 实体，如您不了解 Kook.Net 的多种实现，请参考 <a class="xref" href="terminology.html">术语</a> 。
在异步入口点中创建一个 <a class="xref" href="../../api/Kook.WebSocket.KookSocketClient.html">KookSocketClient</a> 的实例，用于与 KOOK 服务端建立连接，
如有需要，也可向构造函数中传递一个 <a class="xref" href="../../api/Kook.WebSocket.KookSocketConfig.html">KookSocketConfig</a> 的可选参数，
多数情况下，默认值即可。</p>
<p>在连接前，将刚刚创建的日志事件处理程序订阅到客户端的 <code>Log</code> 事件中。
Kook.Net 中的事件与 C# 中的任何其他事件的工作机制类似。</p>
<p>使用 <a class="xref" href="../../api/Kook.Rest.BaseKookClient.html#Kook_Rest_BaseKookClient_LoginAsync_">LoginAsync</a> 方法登录到 KOOK 服务端，登录过程采用的身份认证信息为机器人的 Token。</p>
<p><img src="images/intro/intro-bot-token.png" alt="img.png"></p>
<p>通过调用客户端的 <a class="xref" href="../../api/Kook.WebSocket.KookSocketClient.html#Kook_WebSocket_KookSocketClient_StartAsync_">StartAsync</a> 方法，客户端启动与服务端的连接/重连机制，
<strong>该方法会在连接/重连机制启动后立刻返回</strong>，因此，任何依赖于客户端状态的方法
都应以事件处理程序的形式执行。</p>
<p>为了阻止程序在运行期间的异步入口点返回，请在 <code>MainAsync</code> 方法退出前等待一个无限时长的延迟，
获取其它可以阻止程序继续运行的方法，例如，等待控制台中输入信息。</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Token 可允许您获得对 Bot 的所有访问权限，因此，<strong>不要</strong>与任何无关人员共享 Token！
如您要公开 Bot 的源代码，请将该 Token 存储在外部源中。</p>
<p>在下面的示例中，我们从预定义的变量中获取变量，这是<strong>极其不安全</strong>的，
尤其是在有计划将应用程序以任何形式发布的情况下。</p>
<p>为了能够安全地处理该机密信息，建议以 <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.environment.getenvironmentvariable?view=net-6.0">环境变量</a>、<a href="https://docs.microsoft.com/zh-cn/dotnet/core/extensions/configuration">配置文件</a>、<a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/app-secrets?view=aspnetcore-6.0&amp;tabs=linux">机密管理</a> 等形式存储 Token。</p>
</div>
<pre><code class="lang-csharp" name="Create Client">using KookSocketClient client = new();
client.Log += LogAsync;

//  将 Token 写入字符串变量，用于 Bot 登录过程的身份认证
//  这很不安全，尤其是在有公开源代码的情况下，不应该这么做
string token = &quot;token&quot;;

// 一些其它存储 Token 的方案，如环境变量、文件等
// string token = Environment.GetEnvironmentVariable(&quot;NameOfYourEnvironmentVariable&quot;);
// string token = File.ReadAllText(&quot;token.txt&quot;);
// string token = JsonConvert.DeserializeObject&lt;AConfigurationClass&gt;(File.ReadAllText(&quot;config.json&quot;)).Token;

await client.LoginAsync(TokenType.Bot, token);
await client.StartAsync();

// 阻塞程序直到关闭
await Task.Delay(Timeout.Infinite);
</code></pre>
<p>到这里，客户端应该可以连接到 KOOK 服务端，运行程序，等待片刻，应该可以在 KOOK 客户端中看到 Bot 上线。</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/gehongyan/Kook.Net/blob/master/docs/guides/getting_started/first-bot.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Kook.Net (c) 2022-2024
        </div>
      </div>
    </footer>
  </body>
</html>
