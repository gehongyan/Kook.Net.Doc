<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#29992;&#25143;&#31169;&#32842;&#28040;&#24687;&#25509;&#21475; | Kook.Net &#25991;&#26723; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#29992;&#25143;&#31169;&#32842;&#28040;&#24687;&#25509;&#21475; | Kook.Net &#25991;&#26723; ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="Kook.Net &#25991;&#26723;">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="Guides.QuickReference.Http.DirectMessage">
<h1 id="用户私聊消息接口">用户私聊消息接口</h1>

<p>预声明变量</p>
<pre><code class="lang-csharp">readonly KookSocketClient _socketClient = null;
readonly KookRestClient _restClient = null;

SocketDMChannel socketDmChannel = null;

RestDMChannel restDmChannel = null;

IDMChannel dmChannel = null;
IUserMessage userMessage = null;
</code></pre><h3 id="获取私信聊天消息列表"><a href="https://developer.kookapp.cn/doc/http/direct-message#获取私信聊天消息列表">获取私信聊天消息列表</a></h3>
<p>GET <code>/api/v3/direct-message/list</code></p>
<pre><code class="lang-csharp">IMessage referenceMessage = null;       // 获取消息列表所根据的参考消息位置的
Guid referenceMessageId = default;      // 获取消息列表所根据的参考消息位置的 ID
Direction direction = default; // 获取消息列表的方向
int limit = default;                    // 获取消息列表的数量

// 要缓存文字频道聊天消息，请设置 MessageCacheSize 的值
// 缓存获取文字频道的聊天消息列表
IReadOnlyCollection&lt;SocketMessage&gt; cachedMessages = socketDmChannel.CachedMessages;
IReadOnlyCollection&lt;SocketMessage&gt; conditionalCachedMessages = socketDmChannel.GetCachedMessages(referenceMessage, direction, limit);
IReadOnlyCollection&lt;SocketMessage&gt; conditionalCachedMessagesById = socketDmChannel.GetCachedMessages(referenceMessageId, direction, limit);

// API 请求
IAsyncEnumerable&lt;IReadOnlyCollection&lt;IMessage&gt;&gt; pagedMessages = socketDmChannel.GetMessagesAsync(referenceMessage, direction, limit);
IAsyncEnumerable&lt;IReadOnlyCollection&lt;IMessage&gt;&gt; pagedMessagesById = socketDmChannel.GetMessagesAsync(referenceMessageId, direction, limit);
IAsyncEnumerable&lt;IReadOnlyCollection&lt;RestMessage&gt;&gt; pagedRestMessages = restDmChannel.GetMessagesAsync(referenceMessage, direction, limit);
IAsyncEnumerable&lt;IReadOnlyCollection&lt;RestMessage&gt;&gt; pagedRestMessagesById = restDmChannel.GetMessagesAsync(referenceMessageId, direction, limit);

// 在 ITextChannel 上进行调用
IAsyncEnumerable&lt;IReadOnlyCollection&lt;IMessage&gt;&gt; pagedMessages = dmChannel.GetMessagesAsync(referenceMessage, direction, limit);
IAsyncEnumerable&lt;IReadOnlyCollection&lt;IMessage&gt;&gt; pagedMessagesById = dmChannel.GetMessagesAsync(referenceMessageId, direction, limit);
</code></pre><h3 id="获取私信聊天会话详情"><a href="https://developer.kookapp.cn/doc/http/user-chat#%获取私信聊天会话详情">获取私信聊天会话详情</a></h3>
<p>POST <code>/api/v3/user-chat/view</code></p>
<pre><code class="lang-csharp">// 要缓存文字频道聊天消息，请设置 MessageCacheSize 的值
// 缓存获取文字频道的聊天消息详情
SocketMessage cachedMessage = socketDmChannel.GetCachedMessage(messageId);

// 调用异步方法获取消息详情，在缓存中包含指定的消息对象的情况下，直接返回缓存的消息对象，否则会发起 API 请求获取消息对象
IMessage messageAsync = await socketDmChannel.GetMessageAsync(messageId);

// API 请求
IMessage message = await restDmChannel.GetMessageAsync(messageId);

// 在 IDMChannel 上进行调用
IMessage message = await dmChannel.GetMessageAsync(messageId);
</code></pre><h3 id="发送私信聊天消息"><a href="https://developer.kookapp.cn/doc/http/direct-message#发送私信聊天消息">发送私信聊天消息</a></h3>
<p>POST <code>/api/v3/direct-message/create</code></p>
<pre><code class="lang-csharp">string text = null; // 要发送的文字消息
IQuote quote = null; // 被引用的消息
string filePath = null; // 要发送的文件的路径
string fileName = null; // 要发送的文件的名称
AttachmentType fileType = default; // 要发送的文件的类型
Stream stream = null; // 要发送的文件的流
FileAttachment attachment = default; // 要发送的文件的附件
ICard card = null; // 要发送的卡片
IEnumerable&lt;ICard&gt; cards = null; // 要发送的卡片列表

// API 请求，发送文本消息
Cacheable&lt;IUserMessage,Guid&gt; textMessage = await dmChannel.SendTextAsync(text, quote);
// API 请求，发送文件消息
Cacheable&lt;IUserMessage,Guid&gt; fileMessageFromPath = await dmChannel.SendFileAsync(filePath, fileName, fileType, quote);
Cacheable&lt;IUserMessage,Guid&gt; fileMessageFromStream = await dmChannel.SendFileAsync(stream, fileName, fileType, quote);
Cacheable&lt;IUserMessage,Guid&gt; fileMessageFromAttachment = await dmChannel.SendFileAsync(attachment, quote);
// API 请求，发送单卡片消息
Cacheable&lt;IUserMessage,Guid&gt; cardMessage = await dmChannel.SendCardAsync(card, quote);
// API 请求，发送多卡片消息
Cacheable&lt;IUserMessage,Guid&gt; cardsMessage = await dmChannel.SendCardsAsync(cards, quote);
</code></pre><h3 id="更新私信聊天消息"><a href="https://developer.kookapp.cn/doc/http/direct-message#更新私信聊天消息">更新私信聊天消息</a></h3>
<p>POST <code>/api/v3/direct-message/update</code></p>
<pre><code class="lang-csharp">string content = null; // 要更新的消息的文本
IEnumerable&lt;ICard&gt; cards = null; // 要更新的消息的卡片
IQuote quote = null; // 要更新的消息的引用

// API 请求
await userMessage.ModifyAsync(x =&gt;
{
    x.Content = content;
    x.Cards = cards;
    x.Quote = quote; // 要清除引用，请设置为 Quote.Empty
});
</code></pre><h3 id="删除私信聊天消息"><a href="https://developer.kookapp.cn/doc/http/direct-message#删除私信聊天消息">删除私信聊天消息</a></h3>
<p>POST <code>/api/v3/direct-message/delete</code></p>
<pre><code class="lang-csharp">// API 请求
await userMessage.DeleteAsync();
</code></pre><h3 id="获取频道消息某回应的用户列表"><a href="https://developer.kookapp.cn/doc/http/direct-message#获取频道消息某回应的用户列表">获取频道消息某回应的用户列表</a></h3>
<p>GET <code>/api/v3/direct-message/reaction-list</code></p>
<pre><code class="lang-csharp">IEmote emoji = null; // 要获取用户列表的回应的表情

// 缓存获取消息的回应概要，但不包含用户列表
IReadOnlyDictionary&lt;IEmote,ReactionMetadata&gt; cachedReactions = socketUserMessage.Reactions;

// API 请求
IReadOnlyCollection&lt;IUser&gt; reactionUsers = await userMessage.GetReactionUsersAsync(emoji);
</code></pre><h3 id="给某个消息添加回应"><a href="https://developer.kookapp.cn/doc/http/direct-message#给某个消息添加回应">给某个消息添加回应</a></h3>
<p>POST <code>/api/v3/direct-message/add-reaction</code></p>
<p>有关如何构造 Emoji，请参考 <a class="xref" href="../../guides/emoji/emoji.html">表情符号</a>。</p>
<pre><code>IEmote emoji = null; // 要添加的回应的表情
IEnumerable&lt;IEmote&gt; emojis = null; // 要添加的回应的表情列表

// API 请求
await userMessage.AddReactionAsync(emoji);
await userMessage.AddReactionsAsync(emojis);
</code></pre><h3 id="删除消息的某个回应"><a href="https://developer.kookapp.cn/doc/http/direct-message#删除消息的某个回应">删除消息的某个回应</a></h3>
<p>POST <code>/api/v3/direct-message/delete-reaction</code></p>
<pre><code class="lang-csharp">IEmote emoji = null;
IEnumerable&lt;IEmote&gt; emojis = null;
IUser user = null;

// API 请求
await userMessage.RemoveReactionAsync(emoji, user);
await userMessage.RemoveReactionsAsync(user, emojis);
</code></pre></article>
          </div>
          <div class="contribution-panel mobile-hide">
              <a href="https://github.com/gehongyan/Kook.Net/blob/master/docs/quick_reference/http_api/direct-message.md/#L1" title="Improve this Doc" class="fab btn-warning pull-right"><i class="glyphicon glyphicon-pencil"></i></a>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Kook.Net (c) 2022-2023
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
